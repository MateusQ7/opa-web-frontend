<div class="containe-fluid">
  <opa-yline routeNameToBeUsed="Pedidos" iconPath="/assets/images/order.svg"></opa-yline>
  <div class="container-fluid">
    <div class="text-end">
      <div class="btn btn-primary" (click)="this.showLaunchOrderModal()">
        Lançar pedido
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default mb-4">
          <div class="panel-heading panel-heading-default">
            Fila de pedidos
          </div>
          <div class="panel-body panel-body-fix-height">
            <div ngbAccordion #accordion="ngbAccordion" class="mb-2" *ngFor="let order of this.inProgressOrderList">
              <div ngbAccordionItem [collapsed]="true">
                <div ngbAccordionHeader class="accordion-button custom-header">
                  <div ngbAccordionToggle class="p-0 container-fluid text-start ps-0 opa-accordion-toggle">
                    <div class="opa-accordion-header-container">
                      <div class="opa-accordion-header-icon">
                        <i class="fa-solid fa-bowl-food"></i>
                      </div>
                      <div class="opa-accordion-header-title">
                        {{ order.menuItem.name }}
                      </div>
                      <div class="vertical-line"></div>
                      <div class="order-table">
                        Mesa {{ order.table.id }}
                      </div>
                      <div class="vertical-line"></div>
                      <div class="order-status">
                        <span *ngIf="order.status == 1" class="badge opa-badge opa-badge-warning">Em andamento</span>
                        <span *ngIf="order.status == 2" class="badge opa-badge opa-badge-success">Entregue</span>
                        <span *ngIf="order.status == 3" class="badge opa-badge opa-badge-danger">Cancelado</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div ngbAccordionCollapse>
                  <div ngbAccordionBody class="opa-accordion-body">
                    <ng-template>
                      <div class="row mb-3">
                        <div class="col-12">
                          status do pedido:
                          <span *ngIf="order.status == 1" class="badge opa-badge opa-badge-warning">Em andamento</span>
                          <span *ngIf="order.status == 2" class="badge opa-badge opa-badge-success">Entregue</span>
                          <span *ngIf="order.status == 3" class="badge opa-badge opa-badge-danger">Cancelado</span>
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-12">
                          Mesa: {{ order.table.id }}
                        </div>
                      </div>
                      <div class="row mb-3">
                        <div class="col-12">
                          cliente(s): {{ order.customersName }}
                        </div>
                      </div>
                      <div class="row align-items-center">
                        <div class="col-4">
                          pedido feito às <strong>{{ order.orderedTime }}</strong>
                        </div>
                        <div class="col-4 order-responsible-container text-center">
                          responsável:
                          <strong>{{ order.table.waiter }}</strong>
                          <div class="avatar-container">
                            <i class="fa-solid fa-user-tie"></i>
                          </div>
                        </div>
                        <div class="col-4 text-end">
                          <p class="m-0" *ngIf="order.deliveredTime != 'Não entregue'">*pedido entregue às<strong
                              *ngIf="order.deliveredTime">{{ order.deliveredTime
                              }}</strong></p>
                        </div>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="panel panel-default mb-4">
          <div class="panel-heading panel-heading-default">
            Mesas em andamento
          </div>
          <div class="panel-body panel-body-fix-height">
            <div ngbAccordion #accordion="ngbAccordion" class="mb-2" *ngFor="let table of this.inProgressTables">
              <div ngbAccordionItem [collapsed]="true">
                <div ngbAccordionHeader class="accordion-button custom-header">
                  <div ngbAccordionToggle class="p-0 container-fluid text-start ps-0 opa-accordion-toggle">
                    <div class="opa-accordion-header-container">
                      <div class="opa-accordion-header-icon">
                        <i class="fa-solid fa-receipt"></i>
                      </div>
                      <div class="opa-accordion-header-title">
                        Mesa {{ table.table.id }}
                      </div>
                      <div class="table-open-modal" (click)="this.showOrderModal(table);">
                        Ver mais
                      </div>
                    </div>
                  </div>
                </div>
                <div ngbAccordionCollapse>
                  <div ngbAccordionBody class="opa-accordion-body">
                    <ng-template>
                      <div class="table-orders-info mb-2" *ngFor="let order of table.orders">
                        <div class="table-order-title">
                          {{ order.name }}
                        </div>
                        <hr class="link-line">
                        <div class="table-order-status text-end">
                          <span *ngIf="order.status == 1" class="badge opa-badge opa-badge-warning">Em andamento</span>
                          <span *ngIf="order.status == 2" class="badge opa-badge opa-badge-success">Entregue</span>
                          <span *ngIf="order.status == 3" class="badge opa-badge opa-badge-danger">Cancelado</span>
                        </div>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="launch-order-modal" *ngIf="this.launchOrderModal">
  <opa-launch-order-modal (emitOrders)="receiveOrdersFromModal($event)"
    (close)="this.showLaunchOrderModal()"></opa-launch-order-modal>
</div>

<!-- MODAL TA AQUI CAUE -->
<opa-order-modal *ngIf="this.orderModal" [table]="this.tableToOrderModal"
  (close)="this.showOrderModal()"></opa-order-modal>

<ng-template #content let-modal>
  <div class="modal-header opa-modal-header">
    <div class="opa-modal-header-title">
      <h4 class="modal-title opa-modal-title" id="modal-basic-title">Lançar pedidos
      </h4>
    </div>
  </div>
  <div class="modal-body">
    <form>
      <div class="opa-input-group">
        <label>Produto</label>
        <ng-select [items]="products" bindLabel="name" bindValue="id" [clearable]="false"
          placeholder="-- Selecione o produto --" [clearSearchOnAdd]="true" class="opa-select-2">
        </ng-select>
      </div>
      <div class="orders-form">
        <div class="orders-form-container">
          <div class="opa-input-group">
            <label>Mesa</label>
            <ng-select [items]="tables" bindLabel="name" bindValue="id" [clearable]="false"
              placeholder="-- Selecione a mesa --" [clearSearchOnAdd]="true" class="opa-select-2">
            </ng-select>
          </div>
          <div class="opa-input-group">
            <label>Status do pedido</label>
            <ng-select [items]="orderStatus" bindLabel="name" bindValue="id" [clearable]="false"
              placeholder="-- Selecione o status --" [clearSearchOnAdd]="true" class="opa-select-2">
            </ng-select>
          </div>
        </div>
        <div class="orders-form-container">
          <div class="opa-input-group">
            <label>Clientes</label>
            <ng-select [items]="clients" bindLabel="name" bindValue="id" placeholder="-- Selecione os clientes --"
              [hideSelected]="true" [multiple]="true" [closeOnSelect]="false" [clearSearchOnAdd]="true"
              class="opa-select-2">
              <ng-template ng-label-tmp let-item="item" let-clear="clear">
                <div class="opa-value-container">
                  <span class="">{{item.name}}</span>
                  <span class="value-close-button" (click)="clear(item)" aria-hidden="true">x</span>
                </div>
              </ng-template>
            </ng-select>
          </div>
          <div class="opa-input-group">
            <label>Quantidade</label>
            <input type="number" (keypress)="numberOnly($event)" min="1" max="9" class="input-item">
          </div>
        </div>
      </div>
    </form>
    <div (click)="submitOrder()" class="opa-add-button text-align-center">
      <i class="fa-solid fa-square-plus"></i>
    </div>
    <div class="orders-table-container">
      <table class="opa-table-report opa-table opa-table-striped table-hover">
        <thead>
          <tr>
            <th class="botside-header-checkbox">
              <!-- <input type="checkbox" class="order-checkbox" [ngModel]="this.allCheckboxChecked" (click)="allChecked()"> -->
              <input type="checkbox" class="order-checkbox">
            </th>
            <th scope="col">Pedido</th>
            <th scope="col">Quantidade</th>
            <th scope="col">Mesa</th>
            <th scope="col">Clientes</th>
            <th scope="col">Valor Total</th>
            <th scope="col">Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="order-cell-checkbox">
              <input type="checkbox" class="order-checkbox">
            </th>
            <td>Catinha de paranguejo</td>
            <td>2x</td>
            <td>31</td>
            <td>Fulano, Cicrano</td>
            <td>R$ 100,00</td>
            <td><span class="badge opa-badge opa-badge-danger">Cancelado</span></td>
          </tr>
          <tr>
            <th scope="order-cell-checkbox">
              <input type="checkbox" class="order-checkbox">
            </th>
            <td>Camarão nacional</td>
            <td>1x</td>
            <td>31</td>
            <td>Fulano</td>
            <td>R$ 50,00</td>
            <td><span class="badge opa-badge opa-badge-warning">Em andamento</span></td>
          </tr>
          <tr>
            <th scope="order-cell-checkbox">
              <input type="checkbox" class="order-checkbox">
            </th>
            <td>Filé com fritas</td>
            <td>1x</td>
            <td>31</td>
            <td>Fulano, Cicrano, Beltrano</td>
            <td>R$ 20,00</td>
            <td><span class="badge opa-badge opa-badge-success">Entregue</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close('Save click')">Fechar</button>
    <button type="button" class="btn btn-primary" (click)="modal.close('Save click')">Salvar</button>
  </div>
</ng-template>

<button class="btn btn-lg btn-outline-primary" (click)="launch(content)">Launch demo modal</button>
